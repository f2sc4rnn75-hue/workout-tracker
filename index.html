<!DOCTYPE html>

<html lang="en" data-theme="dark">

<head>

  <meta charset="UTF-8" />

  <title>12-Week Workout Tracker</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />



  <!-- PWA bits (same as before) -->

  <link rel="manifest" href="manifest.webmanifest">

  <meta name="theme-color" content="#0f172a">

  <meta name="apple-mobile-web-app-capable" content="yes" />

  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <meta name="apple-mobile-web-app-title" content="Workout Tracker" />

  <link rel="apple-touch-icon" href="icon-192.png" />



  <style>

    :root {

      --bg: #0f172a;

      --bg-elevated: #020617;

      --border: #1f2937;

      --border-soft: #374151;

      --text: #e5e7eb;

      --text-muted: #9ca3af;

      --text-soft: #6b7280;

      --accent: #3b82f6;

      --danger: #b91c1c;

    }



    [data-theme="light"] {

      --bg: #f3f4f6;

      --bg-elevated: #ffffff;

      --border: #d1d5db;

      --border-soft: #9ca3af;

      --text: #111827;

      --text-muted: #4b5563;

      --text-soft: #6b7280;

      --accent: #2563eb;

      --danger: #b91c1c;

    }



    * {

      box-sizing: border-box;

      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;

    }



    body {

      margin: 0;

      background: var(--bg);

      color: var(--text);

    }



    .app {

      display: flex;

      flex-direction: column;

      min-height: 100vh;

    }



    header {

      padding: 0.75rem 1rem;

      background: var(--bg-elevated);

      border-bottom: 1px solid var(--border);

      display: flex;

      justify-content: space-between;

      align-items: center;

      gap: 0.5rem;

      flex-wrap: wrap;

    }



    header-left {

      display: block;

    }



    header h1 {

      margin: 0;

      font-size: 1.1rem;

      font-weight: 600;

    }



    header .subtitle {

      font-size: 0.8rem;

      color: var(--text-muted);

    }



    .header-actions {

      display: flex;

      align-items: center;

      gap: 0.4rem;

      flex-wrap: wrap;

    }



    .layout {

      display: flex;

      flex: 1;

      min-height: 0;

    }



    aside {

      width: 280px;

      border-right: 1px solid var(--border);

      padding: 0.75rem;

      background: var(--bg-elevated);

    }



    main {

      flex: 1;

      padding: 0.75rem;

      min-width: 0;

    }



    .panel {

      margin-bottom: 0.75rem;

      padding: 0.65rem;

      background: var(--bg-elevated);

      border-radius: 0.75rem;

      border: 1px solid var(--border);

    }



    .panel h2 {

      font-size: 0.85rem;

      margin: 0 0 0.4rem 0;

      color: var(--text-muted);

      text-transform: uppercase;

      letter-spacing: 0.05em;

    }



    select, input, button, textarea {

      border-radius: 0.5rem;

      border: 1px solid var(--border-soft);

      background: var(--bg);

      color: var(--text);

      padding: 0.4rem 0.55rem;

      font-size: 0.9rem;

    }



    select:focus, input:focus, button:focus, textarea:focus {

      outline: 2px solid var(--accent);

      outline-offset: 1px;

      border-color: var(--accent);

    }



    button {

      cursor: pointer;

      border: none;

      background: var(--accent);

      font-weight: 500;

      white-space: nowrap;

    }



    button.secondary {

      background: var(--bg);

      border: 1px solid var(--border-soft);

      color: var(--text);

    }



    button.danger {

      background: var(--danger);

    }



    button.small {

      font-size: 0.75rem;

      padding: 0.2rem 0.4rem;

    }



    .week-select {

      width: 100%;

    }



    .day-tabs {

      display: flex;

      flex-wrap: wrap;

      gap: 0.25rem;

    }



    .day-tab {

      flex: 1 1 45%;

      padding: 0.35rem 0.4rem;

      border-radius: 999px;

      border: 1px solid var(--border-soft);

      background: var(--bg);

      font-size: 0.8rem;

      text-align: center;

      cursor: pointer;

      white-space: nowrap;

      overflow: hidden;

      text-overflow: ellipsis;

    }



    .day-tab.active {

      background: var(--accent);

      border-color: var(--accent);

      color: #f9fafb;

    }



    .small-text {

      font-size: 0.8rem;

      color: var(--text-muted);

    }



    .section-header {

      display: flex;

      justify-content: space-between;

      align-items: center;

      gap: 0.5rem;

      margin-bottom: 0.5rem;

    }



    .section-header h2 {

      margin: 0;

      font-size: 1rem;

      font-weight: 600;

    }



    .badge {

      font-size: 0.7rem;

      padding: 0.1rem 0.45rem;

      border-radius: 999px;

      border: 1px solid var(--border-soft);

      color: var(--text-muted);

    }



    .exercise-list {

      display: flex;

      flex-direction: column;

      gap: 0.6rem;

    }



    .exercise-card {

      padding: 0.6rem;

      border-radius: 0.75rem;

      background: var(--bg-elevated);

      border: 1px solid var(--border);

    }



    .exercise-header {

      display: flex;

      align-items: center;

      gap: 0.5rem;

      margin-bottom: 0.35rem;

    }



    .exercise-header input {

      flex: 1;

    }



    .exercise-meta {

      display: flex;

      flex-wrap: wrap;

      gap: 0.4rem;

      margin-bottom: 0.4rem;

    }



    .inline-input {

      display: flex;

      align-items: center;

      gap: 0.25rem;

      font-size: 0.75rem;

      color: var(--text-muted);

    }



    .inline-input input {

      width: 3rem;

      padding: 0.25rem 0.3rem;

      font-size: 0.75rem;

      text-align: center;

    }



    .sets-table {

      width: 100%;

      border-collapse: collapse;

      margin-top: 0.1rem;

    }



    .sets-table th,

    .sets-table td {

      padding: 0.2rem;

      font-size: 0.8rem;

      text-align: center;

      border-bottom: 1px solid var(--border);

    }



    .sets-table input {

      width: 100%;

      padding: 0.2rem;

      font-size: 0.8rem;

      text-align: center;

    }



    .sets-actions {

      display: flex;

      justify-content: space-between;

      align-items: center;

      margin-top: 0.3rem;

      gap: 0.4rem;

    }



    .muted {

      font-size: 0.75rem;

      color: var(--text-soft);

    }



    .hidden {

      display: none !important;

    }



    .top-tabs {

      display: flex;

      gap: 0.25rem;

      margin-bottom: 0.5rem;

    }



    .top-tab {

      padding: 0.35rem 0.6rem;

      border-radius: 999px;

      border: 1px solid var(--border-soft);

      background: var(--bg-elevated);

      font-size: 0.8rem;

      cursor: pointer;

    }



    .top-tab.active {

      background: var(--accent);

      border-color: var(--accent);

      color: #f9fafb;

    }



    .charts-grid {

      display: grid;

      grid-template-columns: minmax(0, 1fr);

      gap: 0.75rem;

    }



    .chart-card {

      padding: 0.6rem;

      border-radius: 0.75rem;

      background: var(--bg-elevated);

      border: 1px solid var(--border);

    }



    .chart-card h3 {

      margin: 0 0 0.4rem 0;

      font-size: 0.9rem;

    }



    .chart-controls {

      display: flex;

      align-items: center;

      gap: 0.4rem;

      flex-wrap: wrap;

      margin-bottom: 0.4rem;

    }



    canvas {

      width: 100%;

      max-width: 100%;

      height: 200px;

    }



    .timer-panel {

      margin-top: 0.6rem;

      padding: 0.6rem;

      border-radius: 0.75rem;

      background: var(--bg-elevated);

      border: 1px solid var(--border);

      display: flex;

      flex-direction: column;

      gap: 0.4rem;

      max-width: 360px;

    }



    .timer-row {

      display: flex;

      align-items: center;

      gap: 0.5rem;

      flex-wrap: wrap;

      justify-content: space-between;

    }



    .timer-display {

      font-size: 1.4rem;

      font-weight: 600;

    }



    .timer-buttons {

      display: flex;

      gap: 0.35rem;

      flex-wrap: wrap;

    }



    .timer-duration {

      display: flex;

      align-items: center;

      gap: 0.3rem;

      font-size: 0.8rem;

      color: var(--text-muted);

    }



    textarea {

      width: 100%;

      min-height: 40px;

      resize: vertical;

    }



    @media (max-width: 900px) {

      .layout {

        flex-direction: column;

      }



      aside {

        width: 100%;

        border-right: none;

        border-bottom: 1px solid var(--border);

      }

    }

  </style>

</head>

<body>

  <div class="app">

    <header>

      <header-left>

        <h1>12-Week Workout Tracker</h1>

        <div class="subtitle">

          TLIF-friendly strength ‚Ä¢ Track weight, reps, sets, cardio & bodyweight

        </div>

      </header-left>

      <div class="header-actions">

        <button id="themeToggleBtn" class="secondary small" type="button">üåô / ‚òÄÔ∏è</button>

        <button id="importJsonBtn" class="secondary small" type="button">Import Backup</button>

        <button id="exportJsonBtn" class="secondary small" type="button">Export Backup</button>

        <input id="importFileInput" type="file" accept="application/json" class="hidden" />

      </div>

    </header>



    <div class="layout">

      <aside>

        <div class="panel">

          <h2>Program</h2>

          <label class="small-text" for="weekSelect">Week</label>

          <select id="weekSelect" class="week-select"></select>

        </div>



        <div class="panel">

          <h2>Days This Week</h2>

          <div id="dayTabs" class="day-tabs"></div>

          <p class="small-text" style="margin-top:0.5rem;">

            4 training days are set up for TLIF-friendly strength. Modify as needed and clear any moves your provider doesn‚Äôt like.

          </p>

        </div>



        <div class="panel">

          <h2>Bodyweight</h2>

          <div style="display:flex; flex-direction:column; gap:0.35rem;">

            <div class="inline-input" style="justify-content:space-between;">

              <span>Date</span>

              <input type="date" id="bwDateInput" />

            </div>

            <div class="inline-input" style="justify-content:space-between;">

              <span>Weight</span>

              <input type="number" step="0.1" id="bwValueInput" placeholder="lbs" />

            </div>

            <button id="bwAddBtn" class="small" type="button">Add Entry</button>

            <p class="small-text" id="bwLastEntryText"></p>

          </div>

        </div>



        <div class="panel">

          <h2>Cardio Log</h2>

          <div style="display:flex; flex-direction:column; gap:0.35rem;">

            <input id="cardioTypeInput" placeholder="Type (walk, bike‚Ä¶)" />

            <div class="inline-input" style="justify-content:space-between;">

              <span>Duration</span>

              <input type="number" id="cardioDurationInput" placeholder="min" />

            </div>

            <div class="inline-input" style="justify-content:space-between;">

              <span>Distance</span>

              <input type="number" id="cardioDistanceInput" placeholder="mi / km" />

            </div>

            <textarea id="cardioNotesInput" placeholder="RPE / notes"></textarea>

            <button id="cardioAddBtn" class="small" type="button">Add Cardio Session</button>

          </div>

        </div>



        <div class="panel">

          <h2>Actions</h2>

          <button id="resetProgramBtn" class="danger small" style="width:100%; margin-bottom:0.4rem;" type="button">

            Reset 12-Week Template

          </button>

          <p class="small-text">

            Reset only if you want to start from week 1 with a fresh program. This wipes all logged weights, reps, bodyweight & cardio.

          </p>

        </div>

      </aside>



      <main>

        <div class="top-tabs">

          <button id="tabWorkout" class="top-tab active" type="button">Workout</button>

          <button id="tabProgress" class="top-tab" type="button">Progress</button>

        </div>



        <div id="workoutView">

          <div class="section-header">

            <div>

              <h2 id="dayTitle">Week 1 ‚Äì Day 1</h2>

              <div class="small-text" id="daySubtitle"></div>

            </div>

            <span class="badge" id="phaseBadge">Phase 1 ‚Ä¢ Foundation</span>

          </div>



          <div class="exercise-list" id="exerciseList"></div>



          <div style="margin-top:0.75rem;">

            <button id="addExerciseBtn" class="secondary small" type="button">+ Add Exercise</button>

            <span class="muted">

              Tip: after each set, adjust weight & reps to track progress.

            </span>

          </div>



          <div class="timer-panel">

            <div class="timer-row">

              <div>

                <div class="small-text">Rest Timer</div>

                <div class="timer-display" id="timerDisplay">00:60</div>

              </div>

              <div class="timer-buttons">

                <button id="timerStartBtn" class="small" type="button">Start</button>

                <button id="timerPauseBtn" class="secondary small" type="button">Pause</button>

                <button id="timerResetBtn" class="secondary small" type="button">Reset</button>

              </div>

            </div>

            <div class="timer-duration">

              <span>Duration (sec)</span>

              <input type="number" id="timerDurationInput" value="60" min="5" />

            </div>

            <p class="small-text">

              Use this between sets. You‚Äôll still see it while logging weights.

            </p>

          </div>

        </div>



        <div id="progressView" class="hidden">

          <div class="charts-grid">

            <div class="chart-card">

              <h3>Exercise Progress (Max Weight / Week)</h3>

              <div class="chart-controls">

                <label class="small-text">

                  Exercise:

                  <select id="exerciseSelect"></select>

                </label>

              </div>

              <canvas id="exerciseChart"></canvas>

              <p class="small-text">

                Shows the heaviest working set logged each week for the selected exercise.

              </p>

            </div>



            <div class="chart-card">

              <h3>Bodyweight Progress</h3>

              <canvas id="bwChart"></canvas>

              <p class="small-text">

                Tracks bodyweight over time. Aim for a slow, controlled trend in the direction you want (confirm with your provider what‚Äôs appropriate after TLIF).

              </p>

            </div>

          </div>

        </div>

      </main>

    </div>

  </div>



  <script>

    const STORAGE_KEY = "twelveWeekProgram_v2";

    const THEME_KEY = "workoutTheme";



    const DEFAULT_DAY_NAMES = [

      "Day 1 ‚Äì Upper (Supportive Push)",

      "Day 2 ‚Äì Lower (Spine-Friendly)",

      "Day 3 ‚Äì Upper (Pull)",

      "Day 4 ‚Äì Core / Conditioning"

    ];



    // TLIF-friendly templates: focus on supported positions, machines, neutral spine

    function defaultExercisesForDay(dayIndex) {

      switch (dayIndex) {

        case 0:

          return [

            makeExercise("Machine Chest Press"),

            makeExercise("Seated DB Shoulder Press (back supported)"),

            makeExercise("Cable Chest Fly (light)"),

            makeExercise("Triceps Rope Pushdown", 3, 12)

          ];

        case 1:

          return [

            makeExercise("Leg Press (short ROM)"),

            makeExercise("Seated Leg Curl"),

            makeExercise("Bodyweight Box Squat to Bench"),

            makeExercise("Seated Calf Raise")

          ];

        case 2:

          return [

            makeExercise("Lat Pulldown (neutral grip)"),

            makeExercise("Seated Cable Row (chest supported if possible)"),

            makeExercise("Chest-Supported DB Row"),

            makeExercise("Cable Biceps Curl", 3, 12)

          ];

        case 3:

        default:

          return [

            makeExercise("Pallof Press"),

            makeExercise("Dead Bug (bodyweight)"),

            makeExercise("Side Plank (modified on knees)"),

            makeExercise("Treadmill Walk (easy incline)", 1, 10) // duration minutes in reps field if you want

          ];

      }

    }



    function makeExercise(name, targetSets = 3, targetReps = 10) {

      const sets = [];

      for (let i = 0; i < targetSets; i++) {

        sets.push({ weight: "", reps: "" });

      }

      return { name, targetSets, targetReps, sets };

    }



    function createDefaultProgram() {

      const weeks = [];

      for (let w = 1; w <= 12; w++) {

        const days = [];

        for (let d = 0; d < 4; d++) {

          days.push({

            name: DEFAULT_DAY_NAMES[d],

            exercises: defaultExercisesForDay(d)

          });

        }

        weeks.push({ number: w, days });

      }

      return {

        version: 2,

        weeks,

        bodyweight: [],

        cardio: []

      };

    }



    function saveProgram(program) {

      localStorage.setItem(STORAGE_KEY, JSON.stringify(program));

    }



    function migrateLegacy(raw) {

      // v1 structure => wrap it into v2

      const weeks = raw.weeks || createDefaultProgram().weeks;

      return {

        version: 2,

        weeks,

        bodyweight: [],

        cardio: []

      };

    }



    function loadProgram() {

      const raw = localStorage.getItem(STORAGE_KEY);

      if (!raw) {

        // Check if v1 exists

        const v1 = localStorage.getItem("twelveWeekProgram_v1");

        if (v1) {

          try {

            const parsedV1 = JSON.parse(v1);

            const migrated = migrateLegacy(parsedV1);

            saveProgram(migrated);

            return migrated;

          } catch {

            const fresh = createDefaultProgram();

            saveProgram(fresh);

            return fresh;

          }

        }

        const fresh = createDefaultProgram();

        saveProgram(fresh);

        return fresh;

      }

      try {

        const parsed = JSON.parse(raw);

        if (parsed.version !== 2) {

          const migrated = migrateLegacy(parsed);

          saveProgram(migrated);

          return migrated;

        }

        // Ensure fields exist

        if (!Array.isArray(parsed.bodyweight)) parsed.bodyweight = [];

        if (!Array.isArray(parsed.cardio)) parsed.cardio = [];

        if (!Array.isArray(parsed.weeks) || parsed.weeks.length !== 12) {

          parsed.weeks = createDefaultProgram().weeks;

        }

        return parsed;

      } catch {

        const fresh = createDefaultProgram();

        saveProgram(fresh);

        return fresh;

      }

    }



    let program = loadProgram();

    let currentWeekIndex = 0;

    let currentDayIndex = 0;



    const weekSelect = document.getElementById("weekSelect");

    const dayTabs = document.getElementById("dayTabs");

    const exerciseListEl = document.getElementById("exerciseList");

    const dayTitleEl = document.getElementById("dayTitle");

    const daySubtitleEl = document.getElementById("daySubtitle");

    const phaseBadgeEl = document.getElementById("phaseBadge");

    const addExerciseBtn = document.getElementById("addExerciseBtn");

    const resetProgramBtn = document.getElementById("resetProgramBtn");

    const exportJsonBtn = document.getElementById("exportJsonBtn");

    const importJsonBtn = document.getElementById("importJsonBtn");

    const importFileInput = document.getElementById("importFileInput");

    const themeToggleBtn = document.getElementById("themeToggleBtn");



    const tabWorkout = document.getElementById("tabWorkout");

    const tabProgress = document.getElementById("tabProgress");

    const workoutView = document.getElementById("workoutView");

    const progressView = document.getElementById("progressView");



    const bwDateInput = document.getElementById("bwDateInput");

    const bwValueInput = document.getElementById("bwValueInput");

    const bwAddBtn = document.getElementById("bwAddBtn");

    const bwLastEntryText = document.getElementById("bwLastEntryText");

    const cardioTypeInput = document.getElementById("cardioTypeInput");

    const cardioDurationInput = document.getElementById("cardioDurationInput");

    const cardioDistanceInput = document.getElementById("cardioDistanceInput");

    const cardioNotesInput = document.getElementById("cardioNotesInput");

    const cardioAddBtn = document.getElementById("cardioAddBtn");



    const exerciseSelect = document.getElementById("exerciseSelect");

    const exerciseChartCanvas = document.getElementById("exerciseChart");

    const bwChartCanvas = document.getElementById("bwChart");



    const timerDisplay = document.getElementById("timerDisplay");

    const timerStartBtn = document.getElementById("timerStartBtn");

    const timerPauseBtn = document.getElementById("timerPauseBtn");

    const timerResetBtn = document.getElementById("timerResetBtn");

    const timerDurationInput = document.getElementById("timerDurationInput");



    let timerInterval = null;

    let timerRemaining = 60;



    function initTheme() {

      const saved = localStorage.getItem(THEME_KEY);

      if (saved === "light" || saved === "dark") {

        document.documentElement.setAttribute("data-theme", saved);

      }

    }



    function toggleTheme() {

      const current = document.documentElement.getAttribute("data-theme") || "dark";

      const next = current === "dark" ? "light" : "dark";

      document.documentElement.setAttribute("data-theme", next);

      localStorage.setItem(THEME_KEY, next);

    }



    function init() {

      initTheme();

      initWeekSelect();

      renderDayTabs();

      renderCurrentDay();

      updateBodyweightUI();

      populateExerciseSelect();

      renderCharts();

      attachEvents();

      registerServiceWorker();

      initTimer();

    }



    function initWeekSelect() {

      weekSelect.innerHTML = "";

      program.weeks.forEach((week, index) => {

        const opt = document.createElement("option");

        opt.value = index;

        opt.textContent = `Week ${week.number}`;

        weekSelect.appendChild(opt);

      });

      weekSelect.value = currentWeekIndex;

    }



    function renderDayTabs() {

      dayTabs.innerHTML = "";

      const days = program.weeks[currentWeekIndex].days;

      days.forEach((day, index) => {

        const btn = document.createElement("button");

        btn.type = "button";

        btn.className = "day-tab" + (index === currentDayIndex ? " active" : "");

        btn.textContent = day.name;

        btn.addEventListener("click", () => {

          currentDayIndex = index;

          renderDayTabs();

          renderCurrentDay();

        });

        dayTabs.appendChild(btn);

      });

    }



    function getPhaseLabel(weekIndex) {

      if (weekIndex < 4) return "Phase 1 ‚Ä¢ Foundation";

      if (weekIndex < 8) return "Phase 2 ‚Ä¢ Build";

      return "Phase 3 ‚Ä¢ Peak / Transition";

    }



    function renderCurrentDay() {

      const week = program.weeks[currentWeekIndex];

      const day = week.days[currentDayIndex];



      dayTitleEl.textContent = `Week ${week.number} ‚Äì ${day.name}`;

      daySubtitleEl.textContent = "Log what you actually did. Adjust exercises to match your surgeon/PT guidance.";

      phaseBadgeEl.textContent = getPhaseLabel(currentWeekIndex);



      exerciseListEl.innerHTML = "";



      day.exercises.forEach((exercise, exerciseIndex) => {

        const card = document.createElement("div");

        card.className = "exercise-card";



        const header = document.createElement("div");

        header.className = "exercise-header";



        const nameInput = document.createElement("input");

        nameInput.type = "text";

        nameInput.value = exercise.name;

        nameInput.placeholder = "Exercise name";

        nameInput.addEventListener("input", (e) => {

          exercise.name = e.target.value;

          saveProgram(program);

          populateExerciseSelect();

          renderCharts();

        });



        const deleteBtn = document.createElement("button");

        deleteBtn.type = "button";

        deleteBtn.className = "secondary small";

        deleteBtn.textContent = "Delete";

        deleteBtn.addEventListener("click", () => {

          if (confirm(`Delete exercise "${exercise.name}"?`)) {

            day.exercises.splice(exerciseIndex, 1);

            saveProgram(program);

            renderCurrentDay();

            populateExerciseSelect();

            renderCharts();

          }

        });



        header.appendChild(nameInput);

        header.appendChild(deleteBtn);

        card.appendChild(header);



        const meta = document.createElement("div");

        meta.className = "exercise-meta";



        const setsWrapper = document.createElement("div");

        setsWrapper.className = "inline-input";

        const setsLabel = document.createElement("span");

        setsLabel.textContent = "Target sets";

        const setsInput = document.createElement("input");

        setsInput.type = "number";

        setsInput.min = "1";

        setsInput.value = exercise.targetSets;

        setsInput.addEventListener("change", (e) => {

          let newSets = parseInt(e.target.value, 10) || 1;

          if (newSets < 1) newSets = 1;

          exercise.targetSets = newSets;

          if (exercise.sets.length < newSets) {

            for (let i = exercise.sets.length; i < newSets; i++) {

              exercise.sets.push({ weight: "", reps: "" });

            }

          } else if (exercise.sets.length > newSets) {

            exercise.sets = exercise.sets.slice(0, newSets);

          }

          saveProgram(program);

          renderCurrentDay();

        });

        setsWrapper.appendChild(setsLabel);

        setsWrapper.appendChild(setsInput);



        const repsWrapper = document.createElement("div");

        repsWrapper.className = "inline-input";

        const repsLabel = document.createElement("span");

        repsLabel.textContent = "Target reps";

        const repsInput = document.createElement("input");

        repsInput.type = "number";

        repsInput.min = "1";

        repsInput.value = exercise.targetReps;

        repsInput.addEventListener("change", (e) => {

          let newReps = parseInt(e.target.value, 10) || 1;

          if (newReps < 1) newReps = 1;

          exercise.targetReps = newReps;

          saveProgram(program);

        });

        repsWrapper.appendChild(repsLabel);

        repsWrapper.appendChild(repsInput);



        meta.appendChild(setsWrapper);

        meta.appendChild(repsWrapper);

        card.appendChild(meta);



        const table = document.createElement("table");

        table.className = "sets-table";



        const thead = document.createElement("thead");

        thead.innerHTML = `

          <tr>

            <th>Set</th>

            <th>Weight</th>

            <th>Reps</th>

          </tr>

        `;

        table.appendChild(thead);



        const tbody = document.createElement("tbody");

        exercise.sets.forEach((set, setIndex) => {

          const tr = document.createElement("tr");



          const setCell = document.createElement("td");

          setCell.textContent = setIndex + 1;



          const weightCell = document.createElement("td");

          const weightInput = document.createElement("input");

          weightInput.type = "text";

          weightInput.placeholder = "e.g. 50";

          weightInput.value = set.weight;

          weightInput.addEventListener("input", (e) => {

            set.weight = e.target.value;

            saveProgram(program);

            renderCharts();

          });

          weightCell.appendChild(weightInput);



          const repsCell = document.createElement("td");

          const repsInputSet = document.createElement("input");

          repsInputSet.type = "text";

          repsInputSet.placeholder = exercise.targetReps.toString();

          repsInputSet.value = set.reps;

          repsInputSet.addEventListener("input", (e) => {

            set.reps = e.target.value;

            saveProgram(program);

          });

          repsCell.appendChild(repsInputSet);



          tr.appendChild(setCell);

          tr.appendChild(weightCell);

          tr.appendChild(repsCell);

          tbody.appendChild(tr);

        });

        table.appendChild(tbody);

        card.appendChild(table);



        const actionsRow = document.createElement("div");

        actionsRow.className = "sets-actions";



        const addSetBtn = document.createElement("button");

        addSetBtn.type = "button";

        addSetBtn.className = "secondary small";

        addSetBtn.textContent = "+ Add Set";

        addSetBtn.addEventListener("click", () => {

          exercise.sets.push({ weight: "", reps: "" });

          exercise.targetSets = exercise.sets.length;

          saveProgram(program);

          renderCurrentDay();

        });



        const infoText = document.createElement("span");

        infoText.className = "muted";

        infoText.textContent = "Use light, controlled reps. Stop if pain flares; follow your provider‚Äôs instructions.";



        actionsRow.appendChild(addSetBtn);

        actionsRow.appendChild(infoText);

        card.appendChild(actionsRow);



        exerciseListEl.appendChild(card);

      });



      if (day.exercises.length === 0) {

        const empty = document.createElement("p");

        empty.className = "muted";

        empty.textContent = "No exercises yet. Use ‚Äú+ Add Exercise‚Äù to build this day.";

        exerciseListEl.appendChild(empty);

      }

    }



    function attachEvents() {

      weekSelect.addEventListener("change", (e) => {

        currentWeekIndex = parseInt(e.target.value, 10) || 0;

        renderDayTabs();

        renderCurrentDay();

        renderCharts();

      });



      addExerciseBtn.addEventListener("click", () => {

        const week = program.weeks[currentWeekIndex];

        const day = week.days[currentDayIndex];

        day.exercises.push(makeExercise("New Exercise"));

        saveProgram(program);

        renderCurrentDay();

        populateExerciseSelect();

      });



      resetProgramBtn.addEventListener("click", () => {

        if (confirm("This will erase ALL current data and regenerate the 12-week TLIF-friendly template. Continue?")) {

          program = createDefaultProgram();

          saveProgram(program);

          currentWeekIndex = 0;

          currentDayIndex = 0;

          initWeekSelect();

          renderDayTabs();

          renderCurrentDay();

          updateBodyweightUI();

          populateExerciseSelect();

          renderCharts();

        }

      });



      exportJsonBtn.addEventListener("click", () => {

        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(program, null, 2));

        const dlAnchor = document.createElement("a");

        dlAnchor.setAttribute("href", dataStr);

        dlAnchor.setAttribute("download", "workout-program-backup.json");

        dlAnchor.click();

      });



      importJsonBtn.addEventListener("click", () => {

        importFileInput.click();

      });



      importFileInput.addEventListener("change", (e) => {

        const file = e.target.files[0];

        if (!file) return;

        const reader = new FileReader();

        reader.onload = (event) => {

          try {

            const data = JSON.parse(event.target.result);

            if (!data.weeks) throw new Error("Invalid backup");

            program = {

              version: 2,

              weeks: data.weeks,

              bodyweight: data.bodyweight || [],

              cardio: data.cardio || []

            };

            saveProgram(program);

            initWeekSelect();

            renderDayTabs();

            renderCurrentDay();

            updateBodyweightUI();

            populateExerciseSelect();

            renderCharts();

            alert("Backup imported successfully.");

          } catch (err) {

            alert("Could not import backup. File may be invalid.");

          }

        };

        reader.readAsText(file);

      });



      themeToggleBtn.addEventListener("click", toggleTheme);



      tabWorkout.addEventListener("click", () => {

        tabWorkout.classList.add("active");

        tabProgress.classList.remove("active");

        workoutView.classList.remove("hidden");

        progressView.classList.add("hidden");

      });



      tabProgress.addEventListener("click", () => {

        tabProgress.classList.add("active");

        tabWorkout.classList.remove("active");

        workoutView.classList.add("hidden");

        progressView.classList.remove("hidden");

        renderCharts();

      });



      bwAddBtn.addEventListener("click", () => {

        const date = bwDateInput.value || new Date().toISOString().slice(0, 10);

        const val = parseFloat(bwValueInput.value);

        if (!val) {

          alert("Enter a weight value.");

          return;

        }

        program.bodyweight.push({ date, weight: val });

        program.bodyweight.sort((a, b) => a.date.localeCompare(b.date));

        saveProgram(program);

        bwValueInput.value = "";

        updateBodyweightUI();

        renderCharts();

      });



      cardioAddBtn.addEventListener("click", () => {

        const date = new Date().toISOString().slice(0, 10);

        const type = cardioTypeInput.value || "Cardio";

        const duration = parseFloat(cardioDurationInput.value) || null;

        const distance = parseFloat(cardioDistanceInput.value) || null;

        const notes = cardioNotesInput.value || "";

        program.cardio.push({ date, type, duration, distance, notes });

        saveProgram(program);

        cardioTypeInput.value = "";

        cardioDurationInput.value = "";

        cardioDistanceInput.value = "";

        cardioNotesInput.value = "";

        alert("Cardio session saved.");

      });



      exerciseSelect.addEventListener("change", renderCharts);



      timerStartBtn.addEventListener("click", startTimer);

      timerPauseBtn.addEventListener("click", pauseTimer);

      timerResetBtn.addEventListener("click", resetTimer);

      timerDurationInput.addEventListener("change", () => {

        let val = parseInt(timerDurationInput.value, 10) || 60;

        if (val < 5) val = 5;

        timerDurationInput.value = val;

        timerRemaining = val;

        updateTimerDisplay();

      });

    }



    function updateBodyweightUI() {

      if (!program.bodyweight.length) {

        bwLastEntryText.textContent = "No entries yet.";

        const today = new Date().toISOString().slice(0, 10);

        bwDateInput.value = today;

        return;

      }

      const last = program.bodyweight[program.bodyweight.length - 1];

      bwLastEntryText.textContent = `Last: ${last.weight} on ${last.date}`;

      bwDateInput.value = last.date;

    }



    function getAllExerciseNames() {

      const names = new Set();

      program.weeks.forEach(week => {

        week.days.forEach(day => {

          day.exercises.forEach(ex => {

            if (ex.name && ex.name.trim().length > 0) {

              names.add(ex.name.trim());

            }

          });

        });

      });

      return Array.from(names).sort((a, b) => a.localeCompare(b));

    }



    function populateExerciseSelect() {

      const names = getAllExerciseNames();

      exerciseSelect.innerHTML = "";

      if (!names.length) {

        const opt = document.createElement("option");

        opt.value = "";

        opt.textContent = "No exercises yet";

        exerciseSelect.appendChild(opt);

        return;

      }

      names.forEach(name => {

        const opt = document.createElement("option");

        opt.value = name;

        opt.textContent = name;

        exerciseSelect.appendChild(opt);

      });

    }



    function renderCharts() {

      renderExerciseChart();

      renderBodyweightChart();

    }



    function getExerciseWeeklyMaxes(exName) {

      const labels = [];

      const values = [];

      program.weeks.forEach((week, wIdx) => {

        let maxWeight = null;

        week.days.forEach(day => {

          day.exercises.forEach(ex => {

            if (ex.name.trim() === exName.trim()) {

              ex.sets.forEach(set => {

                const val = parseFloat(set.weight);

                if (!isNaN(val)) {

                  if (maxWeight === null || val > maxWeight) {

                    maxWeight = val;

                  }

                }

              });

            }

          });

        });

        if (maxWeight !== null) {

          labels.push(`W${week.number}`);

          values.push(maxWeight);

        }

      });

      return { labels, values };

    }



    function drawLineChart(canvas, labels, values) {

      if (!canvas) return;

      const ctx = canvas.getContext("2d");

      const width = canvas.width = canvas.clientWidth;

      const height = canvas.height = canvas.clientHeight;



      ctx.clearRect(0, 0, width, height);



      if (!labels.length || !values.length) {

        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--text-soft") || "#6b7280";

        ctx.font = "12px system-ui";

        ctx.textAlign = "center";

        ctx.fillText("No data yet", width / 2, height / 2);

        return;

      }



      const minVal = Math.min(...values);

      const maxVal = Math.max(...values);

      const padding = 20;

      const chartWidth = width - padding * 2;

      const chartHeight = height - padding * 2;



      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue("--border-soft") || "#4b5563";

      ctx.lineWidth = 1;

      ctx.beginPath();

      ctx.moveTo(padding, padding);

      ctx.lineTo(padding, height - padding);

      ctx.lineTo(width - padding, height - padding);

      ctx.stroke();



      const range = maxVal === minVal ? 1 : (maxVal - minVal);

      const points = values.map((v, i) => {

        const x = padding + (labels.length === 1 ? chartWidth / 2 : (chartWidth * i / (labels.length - 1)));

        const y = padding + chartHeight * (1 - (v - minVal) / range);

        return { x, y, v, label: labels[i] };

      });



      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue("--accent") || "#3b82f6";

      ctx.lineWidth = 2;

      ctx.beginPath();

      points.forEach((p, idx) => {

        if (idx === 0) ctx.moveTo(p.x, p.y);

        else ctx.lineTo(p.x, p.y);

      });

      ctx.stroke();



      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--accent") || "#3b82f6";

      points.forEach(p => {

        ctx.beginPath();

        ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);

        ctx.fill();

      });



      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--text-soft") || "#6b7280";

      ctx.font = "10px system-ui";

      ctx.textAlign = "center";

      points.forEach((p, idx) => {

        ctx.fillText(labels[idx], p.x, height - padding + 12);

      });

    }



    function renderExerciseChart() {

      const exName = exerciseSelect.value;

      if (!exName) {

        drawLineChart(exerciseChartCanvas, [], []);

        return;

      }

      const { labels, values } = getExerciseWeeklyMaxes(exName);

      drawLineChart(exerciseChartCanvas, labels, values);

    }



    function renderBodyweightChart() {

      const entries = program.bodyweight.slice().sort((a, b) => a.date.localeCompare(b.date));

      const labels = entries.map(e => e.date);

      const values = entries.map(e => e.weight);

      drawLineChart(bwChartCanvas, labels, values);

    }



    function initTimer() {

      const val = parseInt(timerDurationInput.value, 10) || 60;

      timerRemaining = val;

      updateTimerDisplay();

    }



    function updateTimerDisplay() {

      const sec = Math.max(0, timerRemaining);

      const s = sec.toString().padStart(2, "0");

      timerDisplay.textContent = `00:${s}`;

    }



    function startTimer() {

      if (timerInterval) return;

      if (timerRemaining <= 0) {

        timerRemaining = parseInt(timerDurationInput.value, 10) || 60;

      }

      timerInterval = setInterval(() => {

        timerRemaining -= 1;

        if (timerRemaining <= 0) {

          timerRemaining = 0;

          updateTimerDisplay();

          pauseTimer();

          try {

            if (navigator.vibrate) navigator.vibrate(200);

          } catch {}

          alert("Rest time is up");

        } else {

          updateTimerDisplay();

        }

      }, 1000);

    }



    function pauseTimer() {

      if (timerInterval) {

        clearInterval(timerInterval);

        timerInterval = null;

      }

    }



    function resetTimer() {

      pauseTimer();

      timerRemaining = parseInt(timerDurationInput.value, 10) || 60;

      updateTimerDisplay();

    }



    function registerServiceWorker() {

      if ("serviceWorker" in navigator) {

        navigator.serviceWorker.register("service-worker.js").catch((err) => {

          console.log("SW registration failed:", err);

        });

      }

    }



    document.addEventListener("DOMContentLoaded", init);

  </script>

</body>

</html>